<!DOCTYPE html> <!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--> <!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8"><![endif]--> <!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9"><![endif]--> <!--[if gt IE 8]><!--> <html class="no-js"><!--<![endif]--> <head> <meta charset="UTF-8"> <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"> <meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"> <title>Troubleshooting & Tips for Django Projects &#8211; JINH-ZERO-PARK</title> <meta name="description" content="Welcome."> <meta name="keywords" content=""> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="/assets/img/logo.png"> <meta name="twitter:title" content="Troubleshooting & Tips for Django Projects"> <meta name="twitter:description" content="전역하고 2년 만에 다시 개발을 하면서, 전에는 기계적으로 했던 것들도 기억이 가물가물해 일일이 찾아보면서 진행했다."> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="Troubleshooting & Tips for Django Projects"> <meta property="og:description" content="전역하고 2년 만에 다시 개발을 하면서, 전에는 기계적으로 했던 것들도 기억이 가물가물해 일일이 찾아보면서 진행했다."> <meta property="og:url" content="/django-project/"> <meta property="og:site_name" content="JINH-ZERO-PARK"> <meta property="og:image" content="/assets/img/logo.png"> <link rel="canonical" href="/django-project/"> <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="JINH-ZERO-PARK Feed"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- CSS --> <link rel="stylesheet" href="/assets/css/main.css"> <!-- JS --> <script src="/assets/js/modernizr-3.3.1.custom.min.js"></script> <!-- Favicons --> <link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"> <link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"> <link rel="shortcut icon" type="image/png" href="/favicon.png" /> <link rel="shortcut icon" href="/favicon.ico" /> <!-- Background Image --> <style type="text/css">body {background-image:url(/assets/img/placeholder-big.jpg); background-repeat: no-repeat; background-size: cover; }</style> <!-- Post Feature Image --> </head> <body> <nav id="dl-menu" class="dl-menuwrapper" role="navigation"> <button class="dl-trigger">Open Menu</button> <ul class="dl-menu"> <li><a href="/">Home</a></li> <li> <a href="#">About</a> <ul class="dl-submenu"> <li> <img src="/assets/img/logo.png" alt="JINH-ZERO-PARK photo" class="author-photo"> <h4>JINH-ZERO-PARK</h4> <p>Welcome.</p> </li> <li><a href="/about/"><span class="btn btn-inverse">Learn More</span></a></li> <li> <a href="mailto:jinh0park@naver.com" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-envelope-square"></i> Email</a> </li> <li> <a href="http://instagram.com/jinh0park" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-instagram"></i> Instagram</a> </li> <li> <a href="http://github.com/jinh0park" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-github"></i> Github</a> </li> </ul><!-- /.dl-submenu --> </li> <li> <a href="#">Posts</a> <ul class="dl-submenu"> <li><a href="/posts/">All Posts</a></li> <li><a href="/tags/">All Tags</a></li> </ul> </li> <li><a href="/projects/" >Projects</a></li> </ul><!-- /.dl-menu --> </nav><!-- /.dl-menuwrapper --> <!-- Header --> <header class="header" role="banner"> <div class="wrapper animated fadeIn"> <div class="content"> <div class="post-title "> <h1>Troubleshooting & Tips for Django Projects</h1> <h4>20 Nov 2021</h4> <p class="reading-time"> <i class="fa fa-clock-o"></i> Reading time ~3 minutes </p><!-- /.entry-reading-time --> <a class="btn zoombtn" href="/posts/"> <i class="fa fa-chevron-left"></i> </a> </div> <p>전역하고 2년 만에 다시 개발을 하면서, 전에는 기계적으로 했던 것들도 기억이 가물가물해 일일이 찾아보면서 진행했다.</p> <p>새로 프로젝트를 시작하면 실제 개발하는 시간이 3할, 오류 검색하는 시간이 7할 이상 된다고 느낄 정도로 Troubleshooting의 비중이 크다. 그러나 모든 오류에 대한 대처법을 외울 수도 없고, 또 수학문제처럼 항상 막히는 부분에서 막히기 때문에 프로젝트를 할 때마다 이를 정리하면 추후에 유용하게 쓸 수 있을 것 같다.</p> <h2 id="1-프로젝트-설계">1. 프로젝트 설계</h2> <h4 id="react--drf-djangorestframework">React + DRF (DjangoRestFramework)</h4> <p>본 프로젝트는 내가 백엔드, 후배가 프론트를 맡았다. 본래 django 자체는 Frontend와 Backend의 경계가 모호한 framework이다. Django의 template 및 다양한 rendering 기능들이 이를 뒷받침한다. 물론 그런 기능을 들어내고 API View만 구현할 수 있지만 꽤나 비효율적이다. 그럼에도 Back과 Front의 구분의 수요는 여전히 있기에 DRF를 이용한다.</p> <h4 id="project-structure">Project structure</h4> <p>React와 DRF를 연동하는 방법은 여러가지가 있다. 첫번째로 고려한 것은 Django Project의 template 폴더에 빌드된 react site를 넣어 렌더링 하는 방법이었다. 이 경우 Django app을 2개를 만들어 하나는 api용, 하나는 main으로 frontend-side를 렌더링하는 용도로 쓰는 것이었다. 이 경우 프로젝트를 일원화하여 관리할 수 있다는 장점이 있지만, URL 매핑하기가 꽤나 곤란해진다. SPA Project에는 적절하지만 그 외에는 부적절하다고 생각해 폐기했다.</p> <p>두번째는 이를 분리하여 Django는 오로지 api server만 담당하고, frontend는 빌드된 react project를 정적 웹 호스팅 서비스를 이용하는 방법이다. 이 방법이 React+DRF의 Standard라고 생각한다. 그리고 Django에서 static&amp;media 파일들을 서빙하기 위해서는 어차피 S3 같은 호스팅이 필요하기 때문에, 한 버킷에서 둘을 한번에 관리할 수 있어 생각보다 깔끔하게 완성할 수 있다.</p> <h4 id="emailing-service">Emailing Service</h4> <p>본 프로젝트에서 이메일 서비스 구현을 필요로 했다. django 자체에 이메일을 보낼 수 있는 기능이 있는 것으로 아는데, 다량의 메일을 보낼 경우 매우 높은 확률로 스팸처리가 되는 이슈가 있기에, AWS SES를 이용하여 문제를 해결한다.</p> <h2 id="2-django-project-setting">2. Django Project Setting</h2> <h4 id="virtualenv">virtualenv</h4> <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="err">$</span> <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">venv</span> <span class="o">&lt;</span><span class="err">가상환경이름</span><span class="o">&gt;</span>         <span class="c">#python3 부터 venv 모듈 내장</span>
<span class="err">$</span> <span class="n">source</span> <span class="o">&lt;</span><span class="err">가상환경이름</span><span class="o">&gt;/</span><span class="nb">bin</span><span class="o">/</span><span class="n">activate</span>
</code></pre></div> <h4 id="django-setting">Django Setting</h4> <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="err">$</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">django</span>
<span class="err">$</span> <span class="n">django</span><span class="o">-</span><span class="n">admin</span> <span class="n">startproject</span> <span class="o">&lt;</span><span class="err">프로젝트이름</span><span class="o">&gt;</span>
<span class="err">$</span> <span class="n">django</span><span class="o">-</span><span class="n">admin</span> <span class="n">startapp</span> <span class="o">&lt;</span><span class="err">앱이름</span><span class="o">&gt;</span>
</code></pre></div> <h2 id="3-django-관련">3. Django 관련</h2> <h4 id="django-admin">Django Admin</h4> <ul> <li><a href="https://wayhome25.github.io/django/2017/03/22/django-ep8-django-admin/">Django Admin Customizing</a></li> <li> <p>django-jet</p> <p>훌륭한 Admin Theme이지만 세세한 Customizing이 어려워 포기, Django admin에 추가적인 기능(이메일링) 도입을 필요로 했기에 부적절</p> </li> <li> <p>django admin stylize</p> <p><code class="highlighter-rouge">site-packages/django/contrib/admin/template</code>에 있는 기본 template html을 참고하여, templates 폴더에 생성하면 override 가능</p> <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># templates/admin/base.html (example)</span>
<span class="p">{</span><span class="o">%</span> <span class="n">extends</span> <span class="s">"admin/base.html"</span> <span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="n">load</span> <span class="n">static</span> <span class="o">%</span><span class="p">}</span>

<span class="p">{</span><span class="o">%</span> <span class="n">block</span> <span class="n">extrastyle</span> <span class="o">%</span><span class="p">}</span>
<span class="o">&lt;</span><span class="n">link</span> <span class="n">rel</span><span class="o">=</span><span class="s">"stylesheet"</span> <span class="nb">type</span><span class="o">=</span><span class="s">"text/css"</span> <span class="n">href</span><span class="o">=</span><span class="s">"{</span><span class="si">% </span><span class="s">static "</span><span class="n">admin</span><span class="o">.</span><span class="n">css</span><span class="s">" </span><span class="si">%</span><span class="s">}"</span><span class="o">&gt;</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endblock</span> <span class="o">%</span><span class="p">}</span>
</code></pre></div> <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># templates/admin/base_site.html (example)</span>
<span class="p">{</span><span class="o">%</span> <span class="n">extends</span> <span class="s">"admin/base.html"</span> <span class="o">%</span><span class="p">}</span>
<span class="p">{</span><span class="o">%</span> <span class="n">load</span> <span class="n">static</span> <span class="o">%</span><span class="p">}</span>

<span class="p">{</span><span class="o">%</span> <span class="n">block</span> <span class="n">title</span> <span class="o">%</span><span class="p">}</span><span class="n">SNULING</span> <span class="n">Admin</span> <span class="n">Site</span><span class="p">{</span><span class="o">%</span> <span class="n">endblock</span> <span class="o">%</span><span class="p">}</span>

<span class="p">{</span><span class="o">%</span> <span class="n">block</span> <span class="n">branding</span> <span class="o">%</span><span class="p">}</span>
<span class="o">&lt;</span><span class="n">h1</span> <span class="nb">id</span><span class="o">=</span><span class="s">"site-name"</span><span class="o">&gt;&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s">"{</span><span class="si">% </span><span class="s">url 'admin:index' </span><span class="si">%</span><span class="s">}"</span><span class="o">&gt;&lt;</span><span class="n">img</span> <span class="n">src</span><span class="o">=</span><span class="s">"{</span><span class="si">% </span><span class="s">static 'img/snuling_logo.png' </span><span class="si">%</span><span class="s">}"</span><span class="o">/&gt;&lt;/</span><span class="n">a</span><span class="o">&gt;&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endblock</span> <span class="o">%</span><span class="p">}</span>

<span class="p">{</span><span class="o">%</span> <span class="n">block</span> <span class="n">nav</span><span class="o">-</span><span class="k">global</span> <span class="o">%</span><span class="p">}{</span><span class="o">%</span> <span class="n">endblock</span> <span class="o">%</span><span class="p">}</span>
</code></pre></div> </li> <li><a href="https://stackoverflow.com/questions/35875454/django-admin-extending-admin-with-custom-views">django admin, extending admin with custom views</a></li> </ul> <h4 id="authorization">Authorization</h4> <ul> <li> <p>로그인 필요 View Decorator for CBV</p> <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">login_required_cbv</span><span class="p">(</span><span class="n">method</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">decorated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_anonymous</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_401_UNAUTHORIZED</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">decorated</span>
</code></pre></div> </li> <li> <p>DRF Django Authentication 원리</p> <ol> <li><code class="highlighter-rouge">'rest_framework.authtoken'</code> <code class="highlighter-rouge">INSTALLED_APPS</code>에 추가 후 migration</li> <li>View에서 <code class="highlighter-rouge">django.contrib.auth.authentication()</code>을 통해 user를 식별하고, User의 Token을 가져옴</li> <li>회원가입시 또는 로그인시 Token을 반환하면, User는 HTTP Request Header에 <code class="highlighter-rouge">Authorization: Token {token}</code> 추가</li> <li>Header에 해당 Token이 있을 경우 view에서 <code class="highlighter-rouge">request.user</code>를 통해 식별 가능.</li> </ol> </li> </ul> <h4 id="기능-구현">기능 구현</h4> <ul> <li><a href="https://bookpark.github.io/2018-02-01/django-ckeditor">Django에서 WYSIWYG 에디터 사용하기(ckeditor)</a></li> <li> <p><a href="https://dgkim5360.tistory.com/entry/django-signal-example">django signal</a></p> <p><a href="https://docs.djangoproject.com/en/3.2/topics/signals/">documentation</a></p> </li> <li><a href="https://stackoverflow.com/questions/21049330/how-to-backup-a-django-db">Django Database Backup</a></li> </ul> <h4 id="drf-기본">DRF 기본</h4> <ul> <li><a href="https://ssungkang.tistory.com/entry/Django-django-rest-framework-%EB%A5%BC-%EC%9C%84%ED%95%9C-JSON-%EC%A7%81%EB%A0%AC%ED%99%94?category=320582">django rest framework 를 위한 JSON 직렬화</a> - ssung.k 님</li> <li><a href="https://ssungkang.tistory.com/entry/Django-APIView-Mixins-generics-APIView-ViewSet%EC%9D%84-%EC%95%8C%EC%95%84%EB%B3%B4%EC%9E%90">APIView, Mixins, generics APIView, ViewSet을 알아보자</a> - ssung.k 님</li> </ul> <h4 id="troubleshooting">Troubleshooting</h4> <ul> <li> <p><a href="https://developer0809.tistory.com/21">React에서 Django에 API 요청 시 CORS Policy: No ‘Access-Control-Allow-Origin’ 에러 해결</a></p> <p>개발 과정에서 3000 &lt;-&gt; 8000 포트 간 통신 필요할때 유용</p> </li> <li> <p>media file url 관련 문제</p> <p>검색해봐도 마땅한 해결 방법이 없어 꽤나 고민했던 문제였다. API server를 이용할 경우, 업로드한 이미지 파일들은 django project에서 지정한 media storage로 저장되고 해당 이미지 파일들의 url(<code class="highlighter-rouge">&lt;img&gt;</code> 태그에서의 src)은 <code class="highlighter-rouge">/media/XXXX/XXX.jpg</code>와 같은 형태로 저장된다. media storage의 host가 <code class="highlighter-rouge">www.A.com</code>이고, 프로젝트 사이트의 host가 <code class="highlighter-rouge">www.B.com</code>일 경우, 프로젝트 사이트에서 불러오는 이미지의 최종 주소는 후자의 host와 앞의 endpoint를 합쳐 <code class="highlighter-rouge">www.B.com/media/XXXX/XXX.jpg</code>라는 엉뚱한 주소로 호출하게 되어 이미지가 보이지 않는다.</p> <p>이는 media storage와 react 사이트를 하나의 bucket으로 관리함으로서, 같은 host를 가지게 하여 해결하였다.</p> </li> <li> <p>Database read only error <code class="highlighter-rouge">sudo chown &lt;user&gt; &lt;filename&gt;</code>으로 권한 추가</p> </li> </ul> <h2 id="4-서버-배포-aws-관련">4. 서버 배포, AWS 관련</h2> <ul> <li> <h2 id="django-에서-s3에-static-media-파일-저장하고-사용하기"><a href="https://blog.myungseokang.dev/posts/django-use-s3/">django 에서 S3에 Static, media 파일 저장하고 사용하기</a></h2> </li> <li> <p><a href="https://docs.aws.amazon.com/ses/latest/dg/send-an-email-using-sdk-programmatically.html#send-an-email-using-sdk-programmatically-examples">AWS SES Sample Code</a></p> </li> <li><a href="https://nachwon.github.io/django-deploy-1-aws/">AWS EC2로 배포 - uWSGI, nginx 까지</a> <ul> <li>uWSGI log error - “no such file ~~<del>” : `/var/log/</del>~` 에 logging 할 폴더를 만들어줘야함.</li> </ul> </li> </ul> <h2 id="5-기타-소프트웨어-툴-관련">5. 기타 소프트웨어, 툴 관련</h2> <h4 id="postman">Postman</h4> <ul> <li><a href="https://velog.io/@jinee/TIL-Postman%EC%9C%BC%EB%A1%9C-API%EB%AC%B8%EC%84%9C-%EB%A7%8C%EB%93%A4%EA%B8%B0-l4k5mj31rl">Postman으로 API문서 만들기</a></li> </ul> <h4 id="troubleshooting-1">Troubleshooting</h4> <ul> <li><a href="https://yooniversal.github.io/blog/post176/">PUTTY - NO SUPPORTED AUTHENTICATION METHODS AVAILABLE</a> 링크된 오류는 아니었고, ssh 접속 시 username을 <code class="highlighter-rouge">ubuntu</code>로 해주지 않아서 생기는 오류였다… (AWS 기본은 ec2-user)</li> </ul> <div class="entry-meta"> <br> <hr> <span class="entry-tags"></span> <!-- <span class="social-share"> <a href="https://www.facebook.com/sharer/sharer.php?u=/django-project/" title="Share on Facebook" class="tag"> <span class="term"><i class="fa fa-facebook-square"></i> Share</span> </a> <a href="https://twitter.com/intent/tweet?text=/django-project/" title="Share on Twitter" class="tag"> <span class="term"><i class="fa fa-twitter-square"></i> Tweet</span> </a> <a href="https://plus.google.com/share?url=/django-project/" title="Share on Google+" class="tag"> <span class="term"><i class="fa fa-google-plus-square"></i> +1</span> </a> </span> --> <div style="clear:both"></div> </div> </div> </div> <section id="disqus_thread" class="animated fadeInUp"></section><!-- /#disqus_thread --> </header> <!-- JS --> <script src="/assets/js/jquery-1.12.0.min.js"></script> <script src="/assets/js/jquery.dlmenu.min.js"></script> <script src="/assets/js/jquery.goup.min.js"></script> <script src="/assets/js/jquery.magnific-popup.min.js"></script> <script src="/assets/js/jquery.fitvid.min.js"></script> <script src="/assets/js/scripts.js"></script> <!-- MathJax --> <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js"></script> </body> </html>
